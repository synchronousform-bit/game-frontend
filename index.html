<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNC FORM // TERMINAL V7</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>

        :root {
            --bg-overlay: rgba(0, 0, 0, 0.7);
            --panel-bg: rgba(10, 10, 10, 0.85);
            --mono-green: #0f0;
            --mono-gray: #666;
            --mono-light: #ddd;
            --danger: #ff0000;
            --font-xs: 0.7rem;
            --font-sm: 0.85rem;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Share Tech Mono', monospace;
            color: var(--mono-green);
            min-height: 100vh;
            margin: 0;
            background-color: #000; 
            overflow-x: hidden; 
        }


        body::before {
            content: "";
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: url("static/back3.png") no-repeat center center;
            background-size: cover;
            z-index: -2; 
        }

      
        body::after {
            content: ""; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: var(--bg-overlay);
            background-image: linear-gradient(rgba(0, 255, 0, 0.03) 1px, transparent 1px);
            background-size: 100% 4px;
            z-index: -1; 
            pointer-events: none;
        }


        .main-interface {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            grid-template-rows: 1fr 60px;
            gap: 15px;
            height: 100vh;
            padding: 20px;
            max-width: 2560px;
            margin: 0 auto;
        }

        .cyber-panel {
            background: var(--panel-bg);
            border: 1px solid var(--mono-gray);
            backdrop-filter: blur(5px);
            padding: 12px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            font-size: var(--font-xs);
            color: var(--mono-gray);
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 8px;
            padding-bottom: 4px;
            display: flex; justify-content: space-between;
        }

        .cyber-panel::before, .cyber-panel::after {
            content: ''; position: absolute; width: 6px; height: 6px;
            border-style: solid; pointer-events: none;
        }
        .cyber-panel::before { top: -1px; left: -1px; border-width: 2px 0 0 2px; border-color: var(--mono-green); }
        .cyber-panel::after { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; border-color: var(--mono-green); }


        .left-sidebar, .right-sidebar { display: flex; flex-direction: column; gap: 15px; }
        .center-stage { position: relative; display: flex; justify-content: center; align-items: center; }
        .bottom-bar { grid-column: 1 / -1; display: flex; gap: 15px; }


        .interaction-box {
            z-index: 10; width: 100%; max-width: 750px;
            text-align: center; background: rgba(0,0,0,0.8);
            padding: 50px; border: 1px solid var(--mono-gray);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.05);
        }

        input[type="text"] {
            background: rgba(0,0,0,0.8); border: none;
            border-bottom: 2px solid var(--mono-gray);
            color: var(--mono-green); font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem; width: 100%; padding: 15px;
            outline: none; text-transform: uppercase; letter-spacing: 5px;
            text-align: left; transition: 0.3s; margin: 30px 0;
        }
        input[type="text"]::placeholder { font-size: 0.8rem; color: #333; letter-spacing: 2px; }
        input[type="text"]:focus { background: rgba(0, 255, 0, 0.05); border-bottom-color: var(--mono-green); }

        .cyber-button {
            background: transparent; color: var(--mono-gray);
            border: 1px solid var(--mono-gray); font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem; padding: 15px; cursor: pointer; width: 100%;
            font-weight: bold; text-transform: uppercase; letter-spacing: 5px; transition: 0.3s;
        }
        .cyber-button:hover { background: var(--mono-green); color: #000; box-shadow: 0 0 15px var(--mono-green); }

        .output-area {
            min-height: 80px; border-top: 1px dashed #333; padding-top: 20px;
            font-size: 1rem; line-height: 1.5; color: var(--mono-light); text-align: left;
        }


        .map-container {
            flex: 1; min-height: 150px; position: relative;
            overflow: hidden; border: 1px solid #333; margin-top: 10px;
        }
        .map-frame {
            width: 100%; height: 100%; border: 0;
            filter: invert(90%) grayscale(100%) contrast(120%);
            opacity: 0.6; transition: opacity 0.3s;
        }
        .map-frame:hover { opacity: 0.9; }
        .map-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 255, 0, 0.05); pointer-events: none;
            box-shadow: inset 0 0 15px #000;
        }

  
        .bar-graph { 
            display: flex; align-items: flex-end; height: 30px; 
            gap: 2px; width: 100%; opacity: 0.8; margin-top: 10px;
        }
        .bar { 
            flex: 1; background: var(--mono-green); 
            animation: sound-wave 1s ease-in-out infinite alternate;
        }
        @keyframes sound-wave { 0% { height: 10%; } 100% { height: 100%; } }


        .text-green { color: var(--mono-green); text-shadow: 0 0 5px rgba(0, 255, 0, 0.4); }
        .text-gray { color: var(--mono-gray); }
        .text-danger { color: var(--danger); text-shadow: 0 0 5px var(--danger); }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        @media (max-width: 1024px) {
            body { overflow-y: auto; background-attachment: scroll; }
            .main-interface { display: flex; flex-direction: column; height: auto; }
            .center-stage { order: -1; margin-bottom: 20px; }
            .map-container { height: 200px; }
        }
        .sniffer-container {
            margin-top: 15px;
            border: 1px solid #333;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            flex: 1; /* Ocupa o resto do espaço vertical */
            display: flex;
            flex-direction: column;
            min-height: 150px; /* Garante altura mínima */
        }

        .traffic-log {
            flex: 1;
            overflow: hidden; /* Esconde a barra de rolagem mas mantém conteúdo */
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.65rem;
            color: var(--mono-gray);
            line-height: 1.4;
            text-align: left;
            opacity: 0.8;
        }

        .traffic-line {
            display: block;
            white-space: nowrap;
        }

        .highlight-hex { color: var(--mono-green); }
        .highlight-warn { color: #ffff00; }
    </style>
</head>
<body>

    <div class="main-interface">
        <div class="left-sidebar">
            <div class="cyber-panel">
                <div class="panel-header">
                    <span>GEO_TARGET</span>
                    <span class="text-green">● LIVE</span>
                </div>
                <div class="text-gray" style="font-size: 0.7rem; line-height: 1.4;">
                    COORD: <span id="user-coords" class="blink text-green">SCANNING...</span><br>
                    SECTOR: <span id="user-sector">TRIANGULATING...</span><br>
                    ENC: AES-256 [SECURE]
                </div>
                <div class="bar-graph">
                    <div class="bar" style="animation-duration: 2.5s"></div>
                    <div class="bar" style="animation-duration: 3.2s"></div>
                    <div class="bar" style="animation-duration: 1.8s"></div>
                    <div class="bar" style="animation-duration: 4.1s"></div>
                    <div class="bar" style="animation-duration: 2.2s"></div>
                    <div class="bar" style="animation-duration: 3.5s"></div>
                    <div class="bar" style="animation-duration: 1.9s"></div>
                    <div class="bar" style="animation-duration: 2.8s"></div>
                    <div class="bar" style="animation-duration: 3.9s"></div>
                    <div class="bar" style="animation-duration: 2.1s"></div>
                    <div class="bar" style="animation-duration: 3.0s"></div>
                    <div class="bar" style="animation-duration: 1.6s"></div>
                    <div class="bar" style="animation-duration: 2.7s"></div>
                    <div class="bar" style="animation-duration: 3.4s"></div>
                    <div class="bar" style="animation-duration: 2.0s"></div>
                    <div class="bar" style="animation-duration: 3.8s"></div>
                    <div class="bar" style="animation-duration: 2.4s"></div>
                    <div class="bar" style="animation-duration: 3.1s"></div>
                    <div class="bar" style="animation-duration: 1.7s"></div>
                    <div class="bar" style="animation-duration: 2.9s"></div>
                </div>
            </div>

            <div class="cyber-panel" style="flex:1">
                <div class="panel-header">SYSTEM LOGS</div>
                <div style="font-size: 0.7rem; color: #444; margin-bottom: 10px; line-height: 1.5;">
                    > SYNC_NET INIT...<br>
                    > CONNECTING TO DB... OK<br>
                    > WAITING USER INPUT...<br>
                    > PROXY: 192.168.X.X<br>
                    > <span class="blink text-green">LISTENING</span>
                </div>
                <div class="map-container">
                    <iframe 
                        id="map-frame"
                        class="map-frame"
                        src="about:blank" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                    <div class="map-overlay"></div>
                </div>
                <div style="text-align: right; font-size: 0.6rem; color: #333; margin-top: 3px;">SAT_LINK: ONLINE</div>
            </div>
        </div>

        <div class="center-stage">
            <div class="interaction-box">
                <h2 style="font-size: 1.5rem; letter-spacing: 5px; margin-bottom: 5px; color: #fff;">NEX0DER <span class="text-gray">V.06</span></h2>
                <div class="text-gray" style="margin-bottom: 30px; font-size: 0.9rem;">insira a chave extraída</div>
                <div class="cyber-input-group">
                    <input type="text" id="password" maxlength="50" placeholder="Aguardando dados..." autocomplete="off" autofocus>
                    <button class="cyber-button" onclick="verifyData()">DECODIFICAR</button>
                </div>
                <div class="output-area" id="output">
                    <span class="text-green blink">_</span> SISTEMA PRONTO
                </div>
            </div>
        </div>

        <div class="right-sidebar">
            <div class="cyber-panel">
                <div class="panel-header"><span class="text-gray">SYSTEM TIME</span></div>
                <div style="font-size: 2rem; text-align: center; color: var(--mono-green); text-shadow: 0 0 10px rgba(0,255,0,0.2);">
                    <span id="clock">00:00:00</span>
                </div>
            </div>
            <div class="cyber-panel" style="flex:1">
                <div class="panel-header">PROTOCOLS</div>
                <div style="font-size: var(--font-sm); color: #ccc;">
                    1. Identifique o alvo.<br>
                    2. Extraia o dado visual.<br>
                    3. Insira no NEX0DER.<br>
                    4. Receba o CÓDIGO.<br>
                    5. Submeta no Discord.<br>
                    6. Receba sua pontuação.<br><br>
                    <span class="text-gray">> FALHAS SERÃO REGISTRADAS.</span>
                </div>
                <div class="sniffer-container">
                    <div class="panel-header" style="border:none; margin-bottom:5px;">
                        <span>NET_TRAFFIC</span>
                        <span class="blink text-danger">● REC</span>
                    </div>
                    <div id="traffic-log" class="traffic-log">
                        </div>
                </div>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="cyber-panel" style="flex: 1; flex-direction: row; align-items: center; justify-content: space-between;">
                <div class="text-gray" style="font-size:0.5rem">NET_SPEED: <span class="text-green">1.2 GB/S</span></div>
                <div style="font-size: 0.7rem; letter-spacing: 2px; opacity: 0.3; color:#fff">--- SYNC FORM™ ---</div>
                <div class="text-gray" style="font-size:0.5rem">//SECURE LINK//</div>
            </div>
        </div>
    </div>

    <script>
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTypingSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square'; osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.05);
            gain.gain.setValueAtTime(0.02, audioCtx.currentTime); 
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05); 
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.05); 
        }

        let typingTimer;
        const passwordInput = document.getElementById('password');
        const outputDisplay = document.getElementById('output');

        passwordInput.addEventListener('input', function() {
            playTypingSound();
            clearTimeout(typingTimer);
            if (this.value) {
                const fakeHash = Math.random().toString(36).substring(2, 10).toUpperCase();
                outputDisplay.innerHTML = `<span class="text-green blink">>> ANALISANDO: 0x${fakeHash}...</span>`;
            } else {
                outputDisplay.innerHTML = "<span class='text-green blink'>_</span> SISTEMA PRONTO";
            }
            typingTimer = setTimeout(() => {
                if (passwordInput.value) outputDisplay.innerHTML = `<span class="text-gray" style="font-size: 0.9rem;">AGUARDANDO ENVIO [ENTER]</span>`;
            }, 800);
        });

        async function verifyData() {
            // CORREÇÃO AQUI: Verifica diretamente se o input está travado
            if (passwordInput.disabled) return;

            const password = passwordInput.value.trim();
            if (!password) return;
            
            // Trava o input visualmente enquanto carrega
            passwordInput.disabled = true;
            outputDisplay.innerHTML = "<span class='blink text-green'>CONECTANDO...</span>";

            try {
                await new Promise(r => setTimeout(r, 800)); // Charminho visual
                
                const serverURL = 'https://sync-game-backend.onrender.com/check'; 
                
                const response = await fetch(serverURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });

                // === LÓGICA DO BLOQUEIO DE 60 SEGUNDOS ===
                if (response.status === 429) {
                    passwordInput.style.borderBottomColor = "var(--danger)";
                    
                    let segundosRestantes = 60; // Define 60 segundos de bloqueio

                    const cooldownInterval = setInterval(() => {
                        outputDisplay.innerHTML = `
                            <span class="text-danger blink">⛔ ALERTA DE FLOOD</span><br>
                            <span class="text-gray">SISTEMA TRAVADO: ${segundosRestantes}s</span>
                        `;
                        segundosRestantes--;

                        if (segundosRestantes < 0) {
                            clearInterval(cooldownInterval); // Para o contador
                            // Libera o sistema
                            passwordInput.disabled = false; 
                            passwordInput.value = "";
                            passwordInput.style.borderBottomColor = "var(--mono-gray)";
                            outputDisplay.innerHTML = "<span class='text-green blink'>_</span> SISTEMA PRONTO";
                            passwordInput.focus();
                        }
                    }, 1000);
                    
                    return; // Para a execução aqui
                }
                
                const data = await response.json();

                if (data.success) {
                    passwordInput.style.borderBottomColor = "var(--mono-green)";
                    outputDisplay.innerHTML = `<span class="text-green">ACESSO PERMITIDO.</span><br>FLAG: <span style="background:var(--mono-green); color:#000">${data.flag}</span>`;
                    // Mantém desabilitado ou libera dependendo do que você quer fazer depois do sucesso
                     passwordInput.disabled = false;
                } else {
                    passwordInput.style.borderBottomColor = "var(--danger)";
                    outputDisplay.innerHTML = `<span class="text-danger">ACESSO NEGADO.</span><br>Chave incorreta.`;
                    
                    // Libera para tentar de novo após 2 segundos (se não for bloqueio 429)
                    setTimeout(() => {
                        passwordInput.disabled = false; 
                        passwordInput.focus();
                        passwordInput.style.borderBottomColor = "var(--mono-gray)"; 
                        passwordInput.value = "";
                        outputDisplay.innerHTML = "<span class='text-green blink'>_</span> SISTEMA PRONTO";
                    }, 2000);
                }
            } catch (error) {
                console.error(error);
                outputDisplay.innerHTML = "<span class='text-danger'>ERRO DE CONEXÃO.</span>";
                passwordInput.disabled = false;
            }
        }
        
        passwordInput.addEventListener("keypress", (e) => { if (e.key === "Enter") verifyData(); });

        function initGeoSystem() {
            const coordEl = document.getElementById('user-coords');
            const sectorEl = document.getElementById('user-sector');
            const mapFrame = document.getElementById('map-frame');

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        coordEl.classList.remove('blink');
                        coordEl.innerText = `${lat.toFixed(4)} | ${lon.toFixed(4)}`;
                        mapFrame.src = `https://maps.google.com/maps?q=${lat},${lon}&hl=pt&z=14&output=embed`;

                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                            const data = await response.json();
                            let locName = data.address.suburb || data.address.city || "UNKNOWN";
                            sectorEl.innerText = `${locName.toUpperCase().replace(/\s+/g, '_')}_ZONE`;
                            sectorEl.style.color = "#fff";
                        } catch (e) { sectorEl.innerText = "OFF_GRID_SECTOR"; }
                    },
                    (error) => {

                        coordEl.style.color = "var(--danger)";
                        sectorEl.style.color = "var(--danger)";

                        if (error.code === error.PERMISSION_DENIED) {
                            coordEl.innerText = "GEO_BLOCKED";  
                            sectorEl.innerText = "ACCESS_DENIED"; 
    
                            mapFrame.src = "about:blank"; 
                        
                            const overlay = document.querySelector('.map-overlay');
                            overlay.style.backgroundColor = "rgba(0,0,0,0.8)"
                            overlay.innerHTML = `
                                <div style="
                                    display:flex; 
                                    flex-direction:column;
                                    justify-content:center; 
                                    align-items:center; 
                                    height:100%; 
                                    color:var(--danger); 
                                    text-align:center;
                                    font-weight:bold;
                                    letter-spacing: 2px;
                                ">
                                    <div style="margin-top:5px">LOCALIZAÇÃO<br>BLOQUEADA PELO<br>USUÁRIO</div>
                                </div>
                            `;
                        } else {
                            coordEl.innerText = "SIGNAL_LOST";
                            sectorEl.innerText = "SAT_OFFLINE";
                        }
                    }
                );
            } else { 
                coordEl.innerText = "NO_HARDWARE"; 
            }
        }
        window.onload = initGeoSystem;

        function initBarGradient() {
            const bars = document.querySelectorAll('.bar');
            const total = bars.length;
            
            bars.forEach((bar, index) => {
                
                const opacidade = 1 - (index / total * 0.8);
                bar.style.opacity = opacidade;
            });
        }

        window.onload = () => {
            initGeoSystem();    
            initBarGradient();  
        };

        /* ================= PACKET SNIFFER (EFEITO VISUAL) ================= */
        function initSniffer() {
            const logContainer = document.getElementById('traffic-log');
            const verbs = ['AUTH', 'GET', 'POST', 'PING', 'ACK', 'SYN', 'ENC'];
            const systems = ['MAIN_DB', 'SAT_UPLINK', 'NODE_04', 'GATEWAY', 'PROXY'];
            
            // Função para gerar linha aleatória
            function addLine() {
                const verb = verbs[Math.floor(Math.random() * verbs.length)];
                const sys = systems[Math.floor(Math.random() * systems.length)];
                const ip = `192.168.0.${Math.floor(Math.random() * 255)}`;
                const hex = Math.random().toString(16).substring(2, 8).toUpperCase();
                
                // Cria o HTML da linha
                const div = document.createElement('div');
                div.className = 'traffic-line';
                
                // Formata o texto: [VERB] IP -> SYSTEM :: HEX
                div.innerHTML = `[${verb}] ${ip} -> <span class="highlight-hex">${sys}</span> :: 0x${hex}`;
                
                // Adiciona ao container
                logContainer.appendChild(div);
                
                // Rola para baixo automaticamente
                logContainer.scrollTop = logContainer.scrollHeight;
                
                // Limpeza: Mantém apenas as últimas 15 linhas para não pesar o navegador
                if (logContainer.childElementCount > 15) {
                    logContainer.removeChild(logContainer.firstChild);
                }
            }

            // Adiciona uma linha a cada 200ms a 800ms (ritmo variável)
            function loop() {
                const delay = Math.floor(Math.random() * 600) + 200;
                addLine();
                setTimeout(loop, delay);
            }
            
            loop(); // Inicia
        }

        // Adicione ao onload existente
        const oldOnload = window.onload;
        window.onload = () => {
            if (oldOnload) oldOnload();
            initSniffer(); // Inicia o sniffer junto com o resto
        };
    </script>
</body>
</html>